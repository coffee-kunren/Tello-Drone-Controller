# プロジェクト「Tello Drone Controller」

## 目次
- [概要](#概要)
- [使用技術](#使用技術)
- [必要ライブラリ](#必要ライブラリ)
- [機能詳細](#機能詳細)
- [実行の流れ](#実行の流れ)

## 概要
DJI Telloを用いたリアルタイム画像認識対応ドローン制御プログラム。
キーボード操作、録画・写真撮影、ピースサイン自動撮影、前方衝突防止、人間追従（回転）機能を実装。

## 使用技術
- Python
- tellopy
- pygame
- OpenCV
- numpy
- mediapipe
- ultralytics (YOLOv8)

## 必要ライブラリ
```bash
pip install -r requirements.txt
```

※Windows環境では「av」ライブラリ使用のため、ネットから
 「ffmpeg-n8.0-latest-win64-lgpl-shared-8.0」 をダウンロードして
  プロジェクトフォルダ内に配置する必要があります。

## 機能詳細
- キーボードでのドローン操作
  ・キー入力でドローンの操縦やカメラ機能が使えます。
    対応キーは以下の通りです。

  ### 操作キー一覧
  | キー          | 機能                    |
  |---------------|-------------------------|
  | W / A / S / D | 移動（前後左右）        |
  | ↑ / ↓       | 上昇 / 下降             |
  | ← / →       | 回転（左右）            |
  | Tab           | 離陸                    |
  | Backspace     | 着陸                    |
  | R             | 録画（開始 / 停止）     |
  | Enter         | 写真撮影                |
  | C             | 人間追従（ON / OFF）    |

- 内蔵カメラで録画や写真撮影
  ### 対応するキーを押すと写真や録画が保存できます。
      撮影時は画面上中央に「Photo Saved.」が、
      録画中は画面右上に「*REC」が表示されます。

  ### 記録したデータはプロジェクト内「recording」フォルダに、
      "yyyyMMdd_hhmmss/tello_yyyyMMdd_hhmmss.jpg(.mp4)"として
      保存されます。
      ※recordingフォルダは実行時に自動で作成されます。
      ※ファイル名には記録した時の日時が入ります

  ### カメラ起動中、ピースサインを画面内に3秒以上継続すると
     「3，2，1」の後に写真を撮影します。
      ※検出する手はカメラの画角に入った順に認識するため、
        大人数映っている場合は後から映った手が判定対象外に
        なる可能性があるので注意してください。

- 前方衝突防止センサー / 人間追従
  ### カメラで認識した対象(人間)を四角で囲んで表示します。
      画面左下には、その中で最も近い(四角の大きい)対象との
      距離を基準として、ドローンの状態を、
        "SAFE"(遠い)  →  "SLOW"  →  "STOP"(近い)
      の３つにパターン分けして表示しています。

  ### 衝突防止センサーは前進("W"キー)入力に対して、以下の制限
      をかけます。
        "SAFE"：制限なし
        "SLOW"：前進速度を制限(落とす)
        "STOP"：前進禁止
      ※なお、センサーは常に作用しています。

  ### 人間追従はモードON時("C"キー)に画面中央に十字線が表示されます。
      最も近い対象に対して、対象が画面中央にくるようドローンが
      その場で回転(時計/半時計周り)します。
      ※センサーの都合上、前後左右に動く機能は実装していません。

## 実行の流れ
1. ドローンとPCをWi-Fi接続
2. pyファイルを実行
3. 「Tello Controls」ウィンドウと「Tello Camera」ウィンドウの2つが表示
4. 「操作ウィンドウ」をクリックしてフォーカス
5. ドローン操作
6. プログラム終了時：
   - 「画面」をフォーカスして "Q" キー
   - またはコンソールで Ctrl+C
